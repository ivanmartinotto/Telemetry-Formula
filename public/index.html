<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Real-time Telemetry Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #0c1e34;
      color: white;
      font-family: 'Segoe UI', sans-serif;
    }
    .card {
      background-color: #12263f;
      border: none;
    }
    .value {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .label {
      color: #ccc;
    }
    .card h5 {
      color: #ffffff; /* Título branco para contraste */
    }

    .card p {
      color: #dddddd; /* Parágrafos e textos mais claros */
    }

    .value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #ffffff; /* Valores em branco */
    }

  </style>
</head>
<body>
  <div class="container-fluid p-4">
    <div class="row g-3">

      <!-- Status -->
      <div class="col-md-3">
        <div class="card p-3">
          <h5>Status</h5>
          <p><strong>Conexão:</strong> <span id="connStatus" class="text-success">Conectado</span></p>
          <p><strong>Tempo de sessão:</strong> <span id="sessionTime">00:00</span></p>
          <p><strong>Perda de pacotes:</strong> <span id="packetLoss">0,0%</span></p>
        </div>

        <div class="card p-3 mt-3">
          <h5>Leitura Atual</h5>
          <p><span class="label">ax:</span> <span id="axVal" class="value">0.00</span> g</p>
          <p><span class="label">ay:</span> <span id="ayVal" class="value">0.00</span> g</p>
          <p><span class="label">az:</span> <span id="azVal" class="value">0.00</span> g</p>
        </div>
      </div>

      <!-- Gráfico -->
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Aceleração (g)</h5>
          <canvas id="accelChart" height="200"></canvas>
        </div>
      </div>

      <!-- Mapa / Placeholder -->
      <div class="col-md-3">
        <div class="card p-3 h-100">
          <h5>Mapa</h5>
          <div class="text-center pt-5" style="opacity: 0.4;">(em desenvolvimento)</div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const ws = new WebSocket("ws://localhost:8080");

    const labels = [];
    const axData = [];
    const ayData = [];
    const azData = [];

    const chart = new Chart(document.getElementById("accelChart"), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          { label: 'ax', data: axData, borderColor: 'deepskyblue', fill: false },
          { label: 'ay', data: ayData, borderColor: 'tomato', fill: false },
          { label: 'az', data: azData, borderColor: 'limegreen', fill: false }
        ]
      },
      options: {
        animation: false,
        responsive: true,
        scales: {
          y: {
            suggestedMin: -1.5,
            suggestedMax: 1.5
          }
        }
      }
    });

    let startTime = Date.now();
    setInterval(() => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const min = String(Math.floor(elapsed / 60)).padStart(2, '0');
      const sec = String(elapsed % 60).padStart(2, '0');
      document.getElementById("sessionTime").textContent = `${min}:${sec}`;
    }, 1000);

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      const now = new Date();
      const timeLabel = now.toLocaleTimeString();

      if (labels.length > 50) {
        labels.shift(); axData.shift(); ayData.shift(); azData.shift();
      }

      labels.push(timeLabel);
      axData.push(data.ax);
      ayData.push(data.ay);
      azData.push(data.az);
      chart.update();

      // Atualiza os valores ao vivo
      document.getElementById("axVal").textContent = data.ax.toFixed(2);
      document.getElementById("ayVal").textContent = data.ay.toFixed(2);
      document.getElementById("azVal").textContent = data.az.toFixed(2);
    };

    ws.onopen = () => {
      document.getElementById("connStatus").textContent = "Conectado";
      document.getElementById("connStatus").classList.add("text-success");
    };

    ws.onclose = () => {
      document.getElementById("connStatus").textContent = "Desconectado";
      document.getElementById("connStatus").classList.remove("text-success");
      document.getElementById("connStatus").classList.add("text-danger");
    };
  </script>
</body>
</html>
