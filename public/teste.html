<!DOCTYPE html>
<meta name="viewport" content="width=device-widht, initial-scale=1.0">
<html>
<head>
    <title>Dashboard Telemetria</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            padding: 5px;
            box-sizing: border-box;
        }
        /* Laps */
        .lap-register {
            width: 24vw;
            height: 32vh; 
            margin: 1.1vx;
            background: #f0f0f0;
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto; /* Scroll vertical */
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            position: sticky; 
            left: 0;
        }
        .lap-register h2 {
            text-align: center;
            margin-bottom: 3.3%;
            margin-top: 1%;
            font-size: 100%;
            position: sticky;
            top: 0;
            background: #f0f0f0;
            padding: 1px 0;
        }
        .lap-entries {
            flex-grow: 1;
            overflow-y: auto;
        }
        .lap-entry {
            display: grid;
            grid-template-columns: 40px 1fr 1fr;
            gap: 5px;
            padding: 3px 0;
            font-size: 90%;
            border-bottom: 1px solid #ddd;
        }
        .lap-entry-header {
            font-weight: bold;
            position: sticky;
            top: 0;
            background: #f0f0f0;
            border-bottom: 2px solid #333;
        }
        .delta-positive {
            color: #ff4500;
        }
        .delta-negative {
            color: #32cd32;
        }
        .current-lap {
            background-color: rgba(255, 215, 0, 0.2);
        }
        /* Tyres */
        .grid-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #grid-container {
            width: 24vw;
            height: 30vh;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 3px;
            right: 0;
        }
        .box-pair {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        
        .temperature-tire {
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1vw;
            font-weight: bold;
            transition: all 0.5s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .temperature-brakeL{
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1vw;
            font-weight: bold;
            transition: all 0.5s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            justify-self: start;
            align-self: center;
            height: 80%;
            width: 4vw;
        }
        .temperature-brakeR{
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1vw;
            font-weight: bold;
            transition: all 0.5s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            width: 4vw;
            justify-self: end;
            align-self: center;
            height: 80%;
        }
        /* Gauges */
        #grid_container2{
            width: 52vw;
            height: 30vh;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: 1fr;
            row-gap: 10px;
            justify-self: center;
            align-self: top;
            margin-left: 0.5vw;
            margin-right: 0.5vw;
        }
        .titulos_gauge{
            text-align: center;
            margin-top: 3px;
            margin-bottom: 10px;
            font-size: 100%;
            font-weight: bold;
        }
        .twothreshold{
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(to bottom, 
                #ff4500 0%, 
                #ff4500 20%, 
                #32cd32 20%, 
                #32cd32 70%, 
                #ff4500 70%, 
                #ff4500 100%);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        
        .gauge-container {
            width: 7vw;
            height: 26vh;
            position: relative;
            margin-left: 0.5vw;
            margin-right: 0.5vw;
        }
        .gauge-background_temp{
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(to top, 
                #1e90ff 0%, 
                #1e90ff 20%, 
                #32cd32 20%, 
                #32cd32 70%, 
                #ff4500 70%, 
                #ff4500 100%);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        .onethreshold{
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(to top, 
                #ff4500 0%, 
                #ff4500 10%,
                #ffd000 10%,
                #ffd000 25%, 
                #32cd32 25%, 
                #32cd32 100%);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        .rpm{
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(to bottom, /* Inverted */
                #ff4500 0%, 
                #ff4500 20%, 
                #32cd32 20%, 
                #32cd32 100%);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        
        .gauge-bar {
            width: 100%;
            background: rgba(0, 0, 0, 0.466);
            position: absolute;
            bottom: 0;
            left: 0;
            transition: height 0.8s ease;
        }
        
        .gauge-marker {
            position: absolute; 
            left: 110%;
            transform: translateY(-50%);
            font-weight: bold;
        }
        
        .gauge-value {
            text-align: center;
            margin-top: 5px;
            font-size: 100%;
            font-weight: bold;
        }
        /* Special inverted marker positioning */
        .inverted-marker {
            top: auto !important;
            bottom: calc(100% - var(--marker-position)) !important;
        }
        /* Checkboxes */
        .checkbox{
            left: 0;
            bottom: 0;
            position: fixed;
            display: flex;
            width: 15vw;
            height: 64vh;
        }
        .checks_container{
            width: 17vw;
            height: 64vh;
        }
        .rows{
            display: flex;
            font: 100%;
        }
        /*Graphs*/
        .graph-grid{
            bottom: 0;
            position: fixed;
            right: 0;
            width: 80vw;
            height: 64vh;
        }
    </style>
</head>
<body>
    <!-- Lap Register -->
    <div class="lap-register">
        <h2>Lap Times</h2>
        <div class="lap-entries">
            <div class="lap-entry lap-entry-header">
                <div>Lap</div>
                <div>Time</div>
                <div>Delta</div>
            </div>
            <div id="lapEntries"></div>
        </div>
    </div>

    <div class="grid_container2" id="grid_container2">
        <div class="gauge-container">
            <div><h4 class="titulos_gauge">RPM</h4></div>
            <div class="rpm">
                <div class="gauge-bar" id="rpmBar"></div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 0%">13000</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 20%">11500</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 100%">0</div>
            </div>
            <div class="gauge-value" id="rpmValue">1000</div>
        </div>
        <div class="gauge-container">
            <div><h4 class="titulos_gauge">Água (°C)</h4></div>
            <div class="gauge-background_temp">
                <div class="gauge-bar" id="tempBar"></div>
                <div class="gauge-marker" style="top: 0%">110°C</div>
                <div class="gauge-marker" style="top: 20%">100°C</div>
                <div class="gauge-marker" style="top: 70%">70°C</div>
                <div class="gauge-marker" style="top: 100%">0°C</div>
            </div>
            <div class="gauge-value" id="tempAgua">20°C</div>
        </div>
        <div class="gauge-container">
            <div><h4 class="titulos_gauge">Pres. óleo</h4></div>
            <div class="twothreshold">
                <div class="gauge-bar" id="oilpresBar"></div>
                <div class="gauge-marker inverted-marker" style="top: 0%">80psi</div>
                <div class="gauge-marker inverted-marker" style="top: 20%">50psi</div>
                <div class="gauge-marker inverted-marker" style="top: 70%">35psi</div>
                <div class="gauge-marker inverted-marker" style="top: 100%">0psi</div>
            </div>
            <div class="gauge-value" id="presOleo">45psi</div>
        </div>
        <div class="gauge-container">
            <div><h4 class="titulos_gauge">Fuel Pres.</h4></div>
            <div class="twothreshold">
                <div class="gauge-bar" id="fuelpresBar"></div>
                <div class="gauge-marker" style="top: 0%">80psi</div>
                <div class="gauge-marker" style="top: 20%">50psi</div>
                <div class="gauge-marker" style="top: 70%">35psi</div>
                <div class="gauge-marker" style="top: 100%">0psi</div>
            </div>
            <div class="gauge-value" id="presFuel">45psi</div>
        </div>
        <div class="gauge-container">
            <div><h4 class="titulos_gauge">Lambda</h4></div>
            <div class="twothreshold">
                <div class="gauge-bar" id="lambdaBar"></div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 0%">1</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 20%">0.90</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 70%">0.86</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 100%">0</div>
            </div>
            <div class="gauge-value" id="lambdaValue">0.88</div>
        </div>
        <div class="gauge-container">
            <div><h4 class="titulos_gauge">Bateria</h4></div>
            <div class="onethreshold">
                <div class="gauge-bar" id="batteryBar"></div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 0%">0%</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 10%">10%</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 25%">25%</div>
                <div class="gauge-marker inverted-marker" style="--marker-position: 100%">100%</div>
            </div>
            <div class="gauge-value" id="batteryValue">80%</div>
        </div>
    </div>
    
    <div class="grid-section">
        <h4 class="titulos_gauge">Pneus e Freios</h4>
        <div class="grid-container" id="grid-container">
            <!-- Row 1 -->
            <div class="box-pair">
                <div class="temperature-tire" id="box1-1">20°C</div>
                <div class="temperature-brakeL" id="box1-2">20°C</div>
            </div>
            <div class="box-pair">
                <div class="temperature-brakeR" id="box2-1">20°C</div>
                <div class="temperature-tire" id="box2-2">20°C</div>
            </div>
            <!-- Row 2 -->
            <div class="box-pair">
                <div class="temperature-tire" id="box3-1">20°C</div>
                <div class="temperature-brakeL" id="box3-2">20°C</div>
            </div>
            <div class="box-pair">
                <div class="temperature-brakeR" id="box4-1">20°C</div>
                <div class="temperature-tire" id="box4-2">20°C</div>
            </div>
        </div>
    </div>
    <div class="checkbox">
        <fieldset>
            <legend>Datasets</legend>
            <div class="checks_container">
                <div class="row">
                    <div></div>
                </div>
            </div>
        </fieldset>    
    </div>
    <div class="graph-grid">
        
    </div>
    
    <script>
        // Store current temperatures with proper identification
        const boxTypes = {
            'box1-1': 'tire',   // Front Left Tire
            'box1-2': 'brake',  // Front Left Brake
            'box2-1': 'brake',  // Front Right Brake
            'box2-2': 'tire',   // Front Right Tire
            'box3-1': 'tire',   // Rear Left Tire
            'box3-2': 'brake',  // Rear Left Brake
            'box4-1': 'brake',  // Rear Right Brake
            'box4-2': 'tire'    // Rear Right Tire
        };

        const currentTemps = {
            'box1-1': 20, 'box1-2': 20,
            'box2-1': 20, 'box2-2': 20,
            'box3-1': 20, 'box3-2': 20,
            'box4-1': 20, 'box4-2': 20
        };

        function updateAllBoxes() {
            for (const [boxId, boxType] of Object.entries(boxTypes)) {
                // Different temperature change behavior for tires vs brakes
                let change = (Math.random() * 25) - 2.5; // Base random change
                
                if (boxType === 'brake') {
                    // Brake-specific behavior
                    change *= 4; // Brakes change temperature faster
                    if (Math.random() > 0.7) change -= 100; // Cooling tendency
                    currentTemps[boxId] = Math.max(20, Math.min(800, currentTemps[boxId] + change));
                } else {
                    // Tire-specific behavior
                    currentTemps[boxId] = Math.max(20, Math.min(120, currentTemps[boxId] + change));
                }
                
                // Update the display
                const box = document.getElementById(boxId);
                box.textContent = `${currentTemps[boxId].toFixed(1)}°C`;
                
                // Apply the correct color scheme
                if (boxType === 'brake') {
                    // Brake color scheme (20-800°C)
                    if (currentTemps[boxId] <= 250) {
                        box.style.background = '#1e90ff'; // Blue for cold
                    } else if (currentTemps[boxId] > 650) {
                        box.style.background = '#ff4500'; // Red for hot
                    } else {
                        box.style.background = '#32cd32'; // Green for normal
                    }
                } else {
                    // Tire color scheme (20-120°C)
                    if (currentTemps[boxId] < 70) {
                        box.style.background = '#1e90ff'; // Blue for cold
                    } else if (currentTemps[boxId] >= 100) {
                        box.style.background = '#ff4500'; // Red for hot
                    } else {
                        box.style.background = '#32cd32'; // Green for normal
                    }
                }
            }
        }
        // Lap timing system
        let lapCount = 0;
        let lapStartTime = Date.now();
        let bestLapTime = 0;
        const lapEntries = [];

        function formatTime(ms) {
            const minutes = Math.floor(ms / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            const milliseconds = ms % 1000;
            return `${minutes}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0')}`;
        }

        function addLap() {
            const now = Date.now();
            const currentLapTime = now - lapStartTime;
            lapStartTime = now;
            lapCount++;
            
            let delta = "";
            let deltaClass = "";
            
            if (lapCount > 1) {
                const deltaMs = currentLapTime - bestLapTime;
                if (deltaMs > 0) {
                    delta = `+${formatTime(deltaMs)}`;
                    deltaClass = "delta-positive";
                } else if (deltaMs < 0) {
                    delta = `-${formatTime(Math.abs(deltaMs))}`;
                    deltaClass = "delta-negative";
                    bestLapTime = currentLapTime;
                } else {
                    delta = "0.000";
                }
            } else {
                bestLapTime = currentLapTime;
                delta = "0.000";
            }
            
            const lapEntry = {
                number: lapCount,
                time: currentLapTime,
                delta: delta,
                deltaClass: deltaClass
            };
            
            lapEntries.unshift(lapEntry);
            updateLapDisplay();
        }

        function updateLapDisplay() {
            const container = document.getElementById('lapEntries');
            container.innerHTML = '';
            
            lapEntries.forEach((lap, index) => {
                const entry = document.createElement('div');
                entry.className = `lap-entry ${index === 0 ? 'current-lap' : ''}`;
                entry.innerHTML = `
                    <div>${lap.number}</div>
                    <div>${formatTime(lap.time)}</div>
                    <div class="${lap.deltaClass}">${lap.delta}</div>
                `;
                container.appendChild(entry);
            });
        }

        // Gauge simulation functions
        function simulateRPM() {
            const rpmBar = document.getElementById('rpmBar');
            const rpmValue = document.getElementById('rpmValue');
            
            // Simulate engine behavior (idle, acceleration, deceleration)
            let currentRPM = parseFloat(rpmValue.textContent);
            let change = 0;
            
            if (currentRPM < 2000) { // Idle fluctuation
                change = (Math.random() * 200 - 100);
            } else if (currentRPM > 11000) { // Rev limiter
                change = -500;
            } else { // Normal driving
                change = (Math.random() * 800 - 200);
            }
            
            currentRPM = Math.max(800, Math.min(13000, currentRPM + change));
            
            // Update display (inverted)
            rpmValue.textContent = Math.round(currentRPM);
            rpmBar.style.height = `${(currentRPM / 13000 * 100)}%`;
        }

        function simulateWaterTemp() {
            const tempBar = document.getElementById('tempBar');
            const tempValue = document.getElementById('tempAgua');
            
            let currentTemp = parseFloat(tempValue.textContent);
            let change = (Math.random() * 0.4 - 0.2); // Small fluctuations
            
            // Simulate cooling system working
            if (currentTemp > 100) change -= 0.5;
            if (currentTemp < 70) change += 0.3;
            
            currentTemp = Math.max(60, Math.min(110, currentTemp + change));
            
            tempValue.textContent = `${currentTemp.toFixed(1)}°C`;
            tempBar.style.height = `${((currentTemp - 60) / 50 * 100)}%`;
        }

        function simulateOilPressure() {
            const oilBar = document.getElementById('oilpresBar');
            const oilValue = document.getElementById('presOleo');
            
            let currentPressure = parseFloat(oilValue.textContent);
            let change = (Math.random() * 3 - 1.5); // Fluctuations
            
            // Higher RPM = higher oil pressure
            const rpm = parseFloat(document.getElementById('rpmValue').textContent);
            change += (rpm / 13000 * 2);
            
            currentPressure = Math.max(20, Math.min(80, currentPressure + change));
            
            oilValue.textContent = `${currentPressure.toFixed(0)}psi`;
            oilBar.style.height = `${(currentPressure / 80 * 100)}%`;
        }

        function simulateFuelPressure() {
            const fuelBar = document.getElementById('fuelpresBar');
            const fuelValue = document.getElementById('presFuel');
            
            let currentPressure = parseFloat(fuelValue.textContent);
            let change = (Math.random() * 2 - 1); // Fluctuations
            
            // Simulate fuel pump behavior
            if (currentPressure > 60) change -= 0.5;
            if (currentPressure < 40) change += 0.5;
            
            currentPressure = Math.max(30, Math.min(70, currentPressure + change));
            
            fuelValue.textContent = `${currentPressure.toFixed(0)}psi`;
            fuelBar.style.height = `${(currentPressure / 70 * 100)}%`;
        }

        function simulateLambda() {
            const lambdaBar = document.getElementById('lambdaBar');
            const lambdaValue = document.getElementById('lambdaValue');
            
            let currentLambda = parseFloat(lambdaValue.textContent);
            let change = (Math.random() * 0.02 - 0.01); // Small fluctuations
            
            // Simulate richer/leaner mixtures
            const rpm = parseFloat(document.getElementById('rpmValue').textContent);
            if (rpm > 8000) change += 0.005; // Slightly richer at high RPM
            
            currentLambda = Math.max(0.82, Math.min(0.95, currentLambda + change));
            
            lambdaValue.textContent = currentLambda.toFixed(2);
            // Inverted lambda gauge
            lambdaBar.style.height = `${((currentLambda - 0.82) / 0.18 * 100)}%`;
        }

        function simulateBattery() {
            const batteryBar = document.getElementById('batteryBar');
            const batteryValue = document.getElementById('batteryValue');
            
            let currentBattery = parseFloat(batteryValue.textContent);
            let change = (Math.random() * 0.5 - 0.25); // Small discharge/charge
            
            // Simulate alternator charging when RPM > 2000
            const rpm = parseFloat(document.getElementById('rpmValue').textContent);
            if (rpm > 2000) change = Math.abs(change); // Always charge when engine running
            
            currentBattery = Math.max(10, Math.min(100, currentBattery + change));
            
            batteryValue.textContent = `${currentBattery.toFixed(0)}%`;
            // Inverted battery gauge
            batteryBar.style.height = `${currentBattery}%`;
        }

        // Update all gauges
        function updateAllGauges() {
            simulateRPM();
            simulateWaterTemp();
            simulateOilPressure();
            simulateFuelPressure();
            simulateLambda();
            simulateBattery();
        }

        // Update every 500ms for smooth animation
        setInterval(updateAllGauges, 500);
        setInterval(updateAllBoxes, 2000);
        function simulateLap() {
            addLap();
            setTimeout(simulateLap, 60000 + Math.random() * 30000);
        }
        setTimeout(simulateLap, 60000 + Math.random() * 30000);
        
        // Initial update
        updateAllGauges();
        updateAllBoxes();
    </script>
</body>
</html>